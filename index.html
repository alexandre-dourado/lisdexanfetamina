<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker | Lisdexanfetamina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --swiss-black: #000000;
            --swiss-white: #ffffff;
            --swiss-gray-light: #f4f4f5;
            --swiss-gray-text: #71717a;
            --swiss-border: 2px solid #000000;
            --swiss-shadow: 6px 6px 0px 0px #000000;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #1a1a1a;
            overflow: hidden;
        }

        .sidebar-scroll {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .sidebar-scroll::-webkit-scrollbar {
            display: none;
        }

        .active-day {
            background-color: #000;
            color: #fff;
        }

        .glass-detail {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-tool {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
            background: white;
        }

        .btn-tool:hover {
            background: #f9fafb;
            border-color: #000;
        }

        /* --- SWISS TOOLTIP SYSTEM --- */
        .tooltip-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: help;
        }

        .tooltip-content {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 100;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            
            width: 288px;
            background-color: var(--swiss-white);
            border: var(--swiss-border);
            color: var(--swiss-black);
            box-shadow: var(--swiss-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            text-align: left;
        }

        .tooltip-container:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .swiss-header {
            display: flex;
            align-items: stretch;
            border-bottom: var(--swiss-border);
        }

        .swiss-icon-box {
            background-color: var(--swiss-black);
            color: var(--swiss-white);
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swiss-title-box {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0 12px;
        }

        .swiss-title {
            font-size: 16px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            line-height: 1;
            margin: 0;
        }

        .swiss-content {
            padding: 14px;
        }

        .swiss-section {
            margin-bottom: 14px;
        }

        .swiss-section:last-child {
            margin-bottom: 0;
        }

        .swiss-label {
            display: block;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--swiss-gray-text);
            margin-bottom: 4px;
        }

        .swiss-definition {
            font-size: 12px;
            font-weight: 700;
            line-height: 1.3;
            margin: 0;
        }

        .swiss-divider {
            border-top: 1px solid #e4e4e7;
            padding-top: 10px;
        }

        .swiss-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .swiss-list-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.3;
            margin-bottom: 4px;
        }

        .swiss-dot {
            width: 5px;
            height: 5px;
            background-color: var(--swiss-black);
            margin-top: 5px;
            flex-shrink: 0;
        }

        .swiss-marking-box {
            background-color: var(--swiss-gray-light);
            padding: 8px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .swiss-marking-text {
            font-size: 10px;
            font-family: monospace;
            font-weight: 700;
            margin: 0;
        }

        .swiss-footer {
            background-color: var(--swiss-black);
            color: var(--swiss-white);
            padding: 10px;
            display: flex;
            gap: 8px;
            font-style: italic;
        }

        .swiss-footer-text {
            font-size: 10px;
            line-height: 1.3;
            margin: 0;
        }

        .swiss-footer-label {
            font-weight: 900;
            text-transform: uppercase;
            font-style: normal;
            margin-right: 4px;
        }

        .reveal-container .overlay {
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .reveal-container:hover .overlay {
            opacity: 0;
            pointer-events: none;
        }

        /* Checkbox Custom visual */
        .swiss-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid currentColor;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden bg-gray-50">

    <!-- SIDEBAR: HISTÓRICO -->
    <aside class="w-80 bg-white border-r border-gray-200 flex flex-col h-full shrink-0">
        <div class="p-6 border-b border-gray-100 flex justify-between items-center">
            <h1 class="font-extrabold text-xl tracking-tighter uppercase flex items-center gap-2">
                <i data-lucide="clipboard-list" class="w-5 h-5 text-red-600"></i>
                Lisdexanfetamina Tracker
            </h1>
            <button onclick="fetchData()" class="p-2 hover:bg-gray-100 rounded-full transition-colors" title="Sincronizar">
                <i data-lucide="refresh-cw" class="w-4 h-4 text-gray-400"></i>
            </button>
        </div>
        
        <nav id="history-list" class="flex-1 overflow-y-auto sidebar-scroll">
            <div class="p-10 text-center text-gray-300 animate-pulse uppercase text-[10px] font-bold">Carregando...</div>
        </nav>

        <div class="p-4 bg-gray-50 border-t border-gray-200 text-[10px] font-mono text-gray-400 uppercase tracking-widest text-center">
            v3.0 Swiss Core
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto bg-white flex flex-col relative">
        <div class="sticky top-0 z-20 bg-white/80 backdrop-blur-md border-b border-gray-100 px-8 py-4 flex justify-between items-center">
            <div id="priority-hint" class="hidden text-[9px] font-bold uppercase tracking-widest text-gray-400 flex items-center gap-2">
                <i data-lucide="info" class="w-3 h-3 text-red-600"></i>
                Prioridade: Ruído, Clareza, Foco e Pico.
            </div>
            <div class="flex gap-2 ml-auto">
                <button onclick="exportJSON()" class="btn-tool"><i data-lucide="download" class="w-3 h-3 text-blue-600"></i> JSON</button>
                <label class="btn-tool cursor-pointer"><i data-lucide="upload" class="w-3 h-3 text-green-600"></i> Importar<input type="file" id="importJson" accept=".json" class="hidden" onchange="importJSON(event)"></label>
                <div id="day-actions" class="hidden flex gap-2">
                    <button onclick="exportMarkdown()" class="btn-tool bg-black text-white border-black hover:bg-gray-800"><i data-lucide="file-text" class="w-3 h-3"></i> MD</button>
                </div>
            </div>
        </div>

        <div id="detail-view" class="flex-1 max-w-4xl mx-auto p-8 md:p-16 w-full">
            <div class="flex flex-col items-center justify-center h-full text-gray-300 italic font-light space-y-4">
                <i data-lucide="layout" class="w-12 h-12 opacity-20"></i>
                <p>Selecione um registro no histórico.</p>
            </div>
        </div>
    </main>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT1JyTDdbWMSyj6puua-BwPJbfK_c9zie0PPx34P8d0zaUar_t7vPSUGsxNZqQNG1Kr3TeQim9B8xod/pub?gid=0&single=true&output=csv';
        let appData = [];
        let activeIdx = null;

        const SCALE_GOOD_TO_BAD = ['#1D4ED8', '#4ADE80', '#D4FF00', '#FF8C00', '#C00000', '#850000'];

        const TOOLTIP_DATA = {
            ruido: { def: "Quantidade de pensamentos simultâneos competindo por atenção.", obs: ["Quantos assuntos ativos?", "Pensa enquanto pensa?", "Ideias se atropelam?"], scale: "0-1 (Linear) a 4-5 (Atropelado)", tip: "Diminui sem você se sentir acelerado.", icon: "brain-circuit" },
            clareza: { def: "Nitidez para entender contextos e tomar decisões sem névoa.", obs: ["Entende o que está fazendo?", "Menos confusão interna?", "Decisões diretas?"], scale: "0-1 (Névoa) a 4-5 (Espontânea)", tip: "Clareza não é o mesmo que ter energia.", icon: "sparkles" },
            cansaco: { def: "Estado físico real do organismo.", obs: ["Corpo pesado?", "Olhos ardendo?", "Lentidão motora?"], scale: "0-1 (Leve) a 4-5 (Arrastado)", tip: "Estimulantes mascaram — observe sinais sutis.", icon: "battery-low" },
            euforia: { def: "Elevação artificial de humor fora do padrão funcional.", obs: ["Otimismo exagerado?", "Empolgação sem motivo?", "Tudo parece resolvido?"], scale: "Não / Leve / Moderada / Intensa", tip: "Euforia não é o objetivo terapêutico.", icon: "smile" },
            ansiedade: { def: "Estado de ativação acompanhado de desconforto.", obs: ["Tensão corporal?", "Pressa mental?", "Inquietação?"], scale: "Não / Leve / Moderada / Intensa", tip: "Vem com urgência, clareza vem com calma.", icon: "alert-circle" },
            foco: { def: "Capacidade de sustentar a atenção de forma flexível.", obs: ["Fica na tarefa?", "Sai da tarefa sem travar?", "Sem hiperfixação?"], scale: "Contínuo / Rígido / Habitual", tip: "Foco terapêutico deve permitir transição.", icon: "target" },
            pico: { def: "Início abrupto ou nítido demais do efeito.", obs: ["O remédio 'bateu'?", "Mudança repentina?", "Transição nítida?"], scale: "Sim / Não", tip: "Idealmente, a transição deve ser imperceptível.", icon: "trending-up" },
            irritabilidade: { def: "Baixa tolerância emocional no fim do dia.", obs: ["Sons incomodam?", "Pessoas irritam fácil?", "Paciência curta?"], scale: "Sim / Não", tip: "Geralmente associado ao 'crash' de dopamina.", icon: "frown" },
            queda: { def: "Esvaziamento súbito de disposição e humor.", obs: ["Cansaço súbito?", "Humor despenca?", "Fim do efeito nítido?"], scale: "Sim / Não", tip: "Pode ser ajustado com alimentação ou dose.", icon: "arrow-down-circle" },
            sono: { def: "Previsão honesta sobre a capacidade de repouso.", obs: ["Corpo pede descanso?", "Mente desacelerando?", "Sente sono?"], scale: "Melhor / Igual / Pior", tip: "É um prognóstico técnico, não um desejo.", icon: "moon-star" }
        };

        function getSwissColor(val, isInverted) {
            const v = Math.min(Math.max(Math.round(parseFloat(String(val).replace(',', '.')) || 0), 0), 5);
            return isInverted ? SCALE_GOOD_TO_BAD[5 - v] : SCALE_GOOD_TO_BAD[v];
        }

        function isPositive(val) {
            if (!val) return false;
            const n = String(val).toLowerCase().trim();
            return n === 'sim' || n === 'true' || n === 's';
        }

        function generateSwissTooltip(key, title) {
            const data = TOOLTIP_DATA[key];
            if (!data) return "";
            return `
                <div class="swiss-tooltip">
                    <div class="swiss-header"><div class="swiss-icon-box"><i data-lucide="${data.icon}" class="w-5 h-5"></i></div><div class="swiss-title-box"><h2 class="swiss-title">${title}</h2></div></div>
                    <div class="swiss-content">
                        <section class="swiss-section"><span class="swiss-label">Definição</span><p class="swiss-definition">${data.def}</p></section>
                        <section class="swiss-section swiss-divider"><span class="swiss-label">Observar</span><ul class="swiss-list">${data.obs.map(p => `<li class="swiss-list-item"><div class="swiss-dot"></div>${p}</li>`).join('')}</ul></section>
                        <section class="swiss-section"><div class="swiss-marking-box"><span class="swiss-label" style="font-size: 7px;">Escala</span><p class="swiss-marking-text">${data.scale}</p></div></section>
                    </div>
                    <div class="swiss-footer"><i data-lucide="lightbulb" class="w-3 h-3 shrink-0"></i><p class="swiss-footer-text"><span class="swiss-footer-label">Dica:</span>${data.tip}</p></div>
                </div>
            `;
        }

        async function fetchData() {
            try {
                const response = await fetch(`${CSV_URL}&t=${new Date().getTime()}`);
                const csvText = await response.text();
                appData = parseData(csvText);
                renderHistory();
                if (appData.length > 0) selectDay(appData.length - 1);
            } catch (e) { console.error(e); }
        }

        function parseData(text) {
            const lines = text.trim().split(/\r?\n/);
            if (lines.length < 2) return [];
            const separator = lines[0].includes('\t') ? '\t' : ',';
            const headers = lines[0].split(separator).map(h => h.replace(/^"|"$/g, '').trim());
            return lines.slice(1).map(line => {
                let row = [];
                if (separator === ',') {
                    let field = '', inQuotes = false;
                    for (let c of line) {
                        if (c === '"') inQuotes = !inQuotes;
                        else if (c === ',' && !inQuotes) { row.push(field); field = ''; }
                        else field += c;
                    }
                    row.push(field);
                } else row = line.split('\t');
                let obj = {};
                headers.forEach((h, i) => { if (h) obj[h] = (row[i] || "").replace(/^"|"$/g, '').trim(); });
                return obj;
            });
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = appData.slice().reverse().map((day, revIdx) => {
                const actualIdx = appData.length - 1 - revIdx;
                const isActive = activeIdx === actualIdx;
                const drugUse = isPositive(day['Usou cocaína']) || isPositive(day['PO']) || isPositive(day['CHA']) || isPositive(day['CIG']);
                const foco = (day['Foco'] || '').toLowerCase();
                
                return `
                    <div onclick="selectDay(${actualIdx})" class="px-5 py-5 border-b border-gray-50 cursor-pointer transition-all hover:bg-gray-50 flex items-center justify-between group ${isActive ? 'active-day' : ''}">
                        <div class="flex flex-col gap-1">
                            <div class="flex items-center gap-2">
                                <p class="text-[10px] font-bold uppercase tracking-widest ${isActive ? 'text-gray-400' : 'text-gray-400'}">${day['Data']}</p>
                                <div class="flex items-center gap-2 opacity-50">
                                    ${drugUse ? `<i data-lucide="alert-triangle" class="w-2.5 h-2.5 text-red-500"></i>` : ''}
                                    <div class="flex items-center gap-1 text-[8px] font-bold uppercase"><i data-lucide="moon" class="w-2.5 h-2.5"></i>${day['Sono (h)'] || '0'}h</div>
                                    <div class="flex items-center gap-1 text-[8px] font-bold uppercase">
                                        <i data-lucide="${foco.includes('cont') ? 'zap' : foco.includes('ríg') ? 'lock' : 'circle'}" class="w-2.5 h-2.5"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="font-bold text-sm flex items-center gap-1"><i data-lucide="pill" class="w-3 h-3 ${isActive ? 'text-red-400' : 'text-red-600'}"></i>${day['Dose'] || 'N/A'}</p>
                        </div>
                        <div class="flex gap-1.5 h-6">
                            <div class="w-1 rounded-full" style="background-color: ${getSwissColor(day['Ruído mental (0–5)'], false)}"></div>
                            <div class="w-1 rounded-full" style="background-color: ${getSwissColor(day['Clareza (0–5)'], true)}"></div>
                            <div class="w-1 rounded-full" style="background-color: ${getSwissColor(day['Cansaço (0–5)'], false)}"></div>
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        window.selectDay = (index) => {
            activeIdx = index;
            document.getElementById('day-actions').classList.remove('hidden');
            document.getElementById('priority-hint').classList.remove('hidden');
            renderHistory();
            renderDetail(appData[index]);
        };

        function renderDetail(data) {
            const detail = document.getElementById('detail-view');
            const usoGeral = isPositive(data['Usou cocaína']) || isPositive(data['PO']) || isPositive(data['CHA']) || isPositive(data['CIG']);
            const focoValue = (data['Foco'] || '').toLowerCase();
            
            detail.innerHTML = `
                <div class="glass-detail space-y-12 pb-20">
                    <header class="flex flex-col md:flex-row justify-between items-baseline gap-4 border-b-4 border-black pb-8">
                        <div class="flex items-center gap-6">
                             <div class="bg-gray-100 p-4 rounded-full"><i data-lucide="calendar" class="w-10 h-10 text-black"></i></div>
                             <div>
                                <h2 class="text-6xl font-black tracking-tighter">${data['Data']}</h2>
                                <p class="text-sm font-mono uppercase tracking-[0.3em] text-gray-400 flex items-center gap-2"><i data-lucide="clock" class="w-3 h-3"></i> Ingestão: ${data['Hora remédio']}</p>
                            </div>
                        </div>
                        <div class="bg-black text-white px-8 py-4 text-center"><span class="block text-[10px] uppercase tracking-widest opacity-50 mb-1">Dose Ministrada</span><span class="text-3xl font-black">${data['Dose']}</span></div>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-16">
                        <div class="space-y-10">
                            <h3 class="text-[10px] font-black uppercase tracking-[0.5em] border-b border-gray-100 pb-2 text-gray-400 flex items-center gap-2"><i data-lucide="brain" class="w-3 h-3"></i> Estado Mental</h3>
                            ${renderMetricLine("Ruído Mental", data['Ruído mental (0–5)'], "ruido", false)}
                            ${renderMetricLine("Clareza Cognitiva", data['Clareza (0–5)'], "clareza", true)}
                            ${renderMetricLine("Cansaço Físico", data['Cansaço (0–5)'], "cansaco", false)}

                            <div class="pt-6">
                                <div class="tooltip-container mb-6">
                                    <h3 class="text-[10px] font-black uppercase tracking-[0.5em] text-gray-400 underline decoration-dotted underline-offset-4">Foco & Fluxo</h3>
                                    <div class="tooltip-content">${generateSwissTooltip("foco", "Foco & Fluxo")}</div>
                                </div>
                                <div class="grid grid-cols-3 gap-3">
                                    ${renderFocoOption("Igual Habitual", "circle", focoValue.includes("hab"), "#71717a")}
                                    ${renderFocoOption("Mais Contínuo", "zap", focoValue.includes("cont"), "#10b981")}
                                    ${renderFocoOption("Mais Rígido", "lock", focoValue.includes("ríg"), "#f59e0b")}
                                </div>
                            </div>
                        </div>

                        <div class="space-y-8">
                            <h3 class="text-[10px] font-black uppercase tracking-[0.5em] border-b border-gray-100 pb-2 text-gray-400 flex items-center gap-2"><i data-lucide="activity" class="w-3 h-3"></i> Fisiologia</h3>
                            <div class="flex items-center justify-between bg-gray-50 p-6 border-l-4 border-black mb-6">
                                <div class="flex items-center gap-4"><i data-lucide="moon" class="w-8 h-8 text-gray-400"></i><span class="text-lg font-bold uppercase tracking-widest text-gray-600">Tempo Sono</span></div>
                                <div class="flex items-baseline"><span class="text-6xl font-black mr-2">${data['Sono (h)']}</span><span class="text-xs font-bold text-gray-400 uppercase">Horas</span></div>
                            </div>
                            <div class="flex flex-col gap-3">
                                ${renderBadgeRow("Pico de Efeito Percebido", data['Pico claro'], "pico")}
                                ${renderBadgeRow("Estado de Euforia", data['Euforia'], "euforia")}
                                ${renderBadgeRow("Nível de Ansiedade", data['Ansiedade'], "ansiedade")}
                                ${renderBadgeRow("Queda Brusca de Energia", data['Queda energia'], "queda")}
                                ${renderBadgeRow("Irritabilidade (Crash)", data['Irritado fim do dia'], "irritabilidade")}
                                ${renderBadgeRow("Sono Esperado", data['Sono esperado'], "sono")}
                            </div>

                            <!-- REDUÇÃO DE DANOS SIMPLIFICADA -->
                            <div class="reveal-container relative mt-12 border-2 border-red-600 min-h-[140px] bg-red-50 flex flex-col justify-center">
                                <div class="overlay absolute inset-0 bg-red-600 z-10 flex items-center justify-center text-white cursor-help"><i data-lucide="zap" class="w-16 h-16"></i></div>
                                <div class="p-8 space-y-6">
                                    <div class="flex justify-between items-center border-b border-red-200 pb-2">
                                        <span class="text-[10px] font-black text-red-600 uppercase tracking-widest">Monitoramento Substâncias</span>
                                        <span class="font-black text-xl ${usoGeral ? 'text-red-700 underline' : 'text-gray-300'}">${usoGeral ? 'ALERTA' : 'LIMPO'}</span>
                                    </div>
                                    <div class="flex justify-around gap-2">
                                        ${renderDrugIcon("cigarette", data['CIG'])}
                                        ${renderDrugIcon("leaf", data['CHA'])}
                                        ${renderDrugIcon("skull", data['Usou cocaína'] || data['PO'])}
                                    </div>
                                    <div class="pt-2 border-t border-red-100 flex items-start gap-2">
                                        <i data-lucide="message-square" class="w-4 h-4 text-red-300 mt-0.5"></i>
                                        <div><p class="text-[9px] text-red-400 uppercase font-bold">Impulsividade</p><p class="text-xs font-medium text-red-900 leading-tight">${data['Pensamento sobre uso'] || '...'}</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-12 pt-12 border-t border-gray-100"><h3 class="text-[10px] font-black uppercase text-gray-400 mb-6 flex justify-center gap-2 font-mono tracking-widest uppercase italic"><i data-lucide="quote" class="w-3 h-3"></i> Observação Curta</h3><div class="text-4xl font-light text-gray-800 italic text-center max-w-2xl mx-auto">${data['Observação curta'] || '...'}</div></div>
                </div>
            `;
            lucide.createIcons();
        }

        function renderFocoOption(label, icon, active, color) {
            return `
                <div class="flex flex-col items-center gap-2 p-3 border-2 transition-all ${active ? 'border-black bg-white opacity-100' : 'border-gray-100 opacity-20'}">
                    <i data-lucide="${icon}" class="w-6 h-6" style="color: ${active ? color : '#ccc'}"></i>
                    <span class="text-[9px] font-black uppercase text-center leading-none">${label}</span>
                </div>
            `;
        }

        function renderMetricLine(label, value, key, isInverted) {
            const color = getSwissColor(value, isInverted);
            return `<div class="flex items-center space-x-6">
                <div class="w-16 h-16 shrink-0 flex items-center justify-center border-2 border-gray-100 rounded-full text-2xl font-black" style="color: ${color}; border-color: ${color}22">${value}</div>
                <div class="flex-1">
                    <div class="tooltip-container">
                        <i data-lucide="${TOOLTIP_DATA[key].icon}" class="w-3 h-3 text-gray-400 mr-1"></i>
                        <p class="text-xs font-bold uppercase tracking-widest text-gray-400 underline decoration-dotted underline-offset-4">${label}</p>
                        <div class="tooltip-content">${generateSwissTooltip(key, label)}</div>
                    </div>
                    <div class="w-full h-1 bg-gray-100 rounded-full overflow-hidden mt-1"><div class="h-full transition-all duration-700" style="width: ${(value/5)*100}%; background-color: ${color}"></div></div>
                </div>
            </div>`;
        }

        function renderBadgeRow(label, val, key) {
            const pos = isPositive(val);
            return `<div class="flex items-center justify-between p-4 border border-gray-100 hover:border-black transition-all group ${pos ? 'bg-red-50 border-red-300' : ''}">
                <div class="tooltip-container">
                    <i data-lucide="${TOOLTIP_DATA[key].icon}" class="w-5 h-5 ${pos ? 'text-red-600' : 'text-gray-300'} mr-4"></i>
                    <span class="text-gray-500 text-xs font-bold uppercase underline decoration-dotted underline-offset-4 tracking-tighter">${label}</span>
                    <div class="tooltip-content">${generateSwissTooltip(key, label)}</div>
                </div>
                <span class="${pos ? 'text-red-600' : 'text-gray-900'} text-sm font-black tracking-widest uppercase">${val || 'NÃO'}</span>
            </div>`;
        }

        function renderDrugIcon(icon, val) {
            const pos = isPositive(val);
            return `
                <div class="flex flex-col items-center gap-2">
                    <i data-lucide="${icon}" class="w-8 h-8 ${pos ? 'text-red-600' : 'text-gray-200'}"></i>
                    <div class="swiss-checkbox ${pos ? 'bg-red-600 border-red-600 text-white' : 'border-gray-200 text-transparent'}">
                        <i data-lucide="check" class="w-3 h-3"></i>
                    </div>
                </div>
            `;
        }

        function exportJSON() { const s = JSON.stringify(appData, null, 2); const b = new Blob([s], { type: "application/json" }); const u = URL.createObjectURL(b); const l = document.createElement("a"); l.href = u; l.download = "ldxftmn_export.json"; l.click(); }
        function importJSON(e) { const f = e.target.files[0]; if (!f) return; const r = new FileReader(); r.onload = (ev) => { try { const d = JSON.parse(ev.target.result); if (Array.isArray(d)) { appData = d; activeIdx = d.length - 1; renderHistory(); selectDay(activeIdx); } } catch (err) { alert("Erro JSON"); } }; r.readAsText(f); }
        function exportMarkdown() { if (activeIdx === null) return; const d = appData[activeIdx]; const c = `# Relatório Lisdexanfetamina - ${d.Data}\n\nDose: ${d.Dose}\n\nFoco: ${d.Foco}\n\nObs: ${d['Observação curta']}`; const b = new Blob([c], { type: "text/markdown" }); const u = URL.createObjectURL(b); const l = document.createElement("a"); l.href = u; l.download = `lisdexanfetamina_${d.Data.replace(/\//g,'-')}.md`; l.click(); }

        window.onload = fetchData;
    </script>
</body>
</html>
